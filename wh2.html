<html>
<head>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <meta charset="uft-8">
    <style>
	body{
	    background-color: #2C2C39;
	}
	.axis line{
	    fill: none;
	    stroke: white;
	    stroke-width: 2;
	}
	.axis path{
	    fill: none;
	    stroke: white;
	    stroke-width: 2;
	}
	.axis text{
	    fill: white;
	    font-size: 14;
	    font-weight: 100;
	}
	.line{
	    fill: none;
	    stroke-width: 3;
	}
	.overlay{
	    fill: none;
	    pointer-events: all;
	}
	.text{
	    fill: white;
	    font-size: 12;
	}		
    </style>
</head>
<body>

<script>
url = "https://ntu-csx-d3js.github.io/D06222008/hw2.csv"
d3.csv(url, function(error, data){
	//console.log(data);
	if(error){
	    console.log(error);
	}
	
	var years = [];
	var num_professor = [];
	var num_associate = [];
	var num_assistant = [];
	var num_lecturer = [];	
	
	var colorset = ["#29b6f6", "#E34247", "#FEB32E", "#3bcec0"];
		
	//  Fixed issue: return wrong value of d3.max and d3.min 
	//  https://stackoverflow.com/questions/30874617/d3-max-didnt-get-the-correct-value
	for ( var i = 0; i < data.length; i++){
	    years.push(parseInt(data[i].year));
	    num_professor.push(parseInt(data[i].professor));
	    num_associate.push(parseInt(data[i].associate));
	    num_assistant.push(parseInt(data[i].assistant));
	    num_lecturer.push(parseInt(data[i].lecturer));
	}
		
	var width = 800; //定義寬
	var height = 500; //定義高
	//var m = 20; //定義邊界
	//var n = 50; //定義 Axis 邊界
	
	var padding = { top: 50, right: 50, bottom: 50, left: 50};
	var canvas_width = width - padding.left - padding.right;
	var canvas_height = height - padding.top - padding.bottom;

	var Ymax = d3.max(num_professor);
	var Ymin = d3.min(num_assistant);
	var Xmax = d3.extent(years)[1];
	var Xmin = d3.extent(years)[0];
	
	//var Ymax = d3.max(data, function(d){ return d.professor; });
	//var Ymin = d3.min(data, function(d){ return d.assistant; });
	//var Xmax = d3.max(data, function(d){ return d.year; });
	//var Xmin = d3.min(data, function(d){ return d.year; });

	//console.log(Ymax, Ymin, Xmax, Xmin);
	//console.log(data.professor.length);
	//建立 x 軸的尺度
	//var xScale = d3.scaleLinear().domain([Xmin, Xmax]).range([n, w-n]);

	var xScale = d3.scaleLinear().domain([Xmin, Xmax]).range([0, canvas_width]);
	//建立 y 軸的尺度
	var yScale = d3.scaleLinear().domain([Ymin, Ymax]).range([canvas_height, 0]);	
	//D3.js line generator
	
	// Note: interpolate syntax is different between v3 & v4
        // http://bl.ocks.org/emmasaunders/c25a147970def2b02d8c7c2719dc7502	
	
	var line_professor = d3.line()
	    .x(function(d){ return xScale(d.year); })
	    .y(function(d){ return yScale(d.professor); })
	    .curve(d3.curveCardinal);
	var line_associate = d3.line()
	    .x(function(d){ return xScale(d.year); })
	    .y(function(d){ return yScale(d.associate); })
	    .curve(d3.curveCardinal); 
	var line_assistant = d3.line()
	    .x(function(d){ return xScale(d.year); })
	    .y(function(d){ return yScale(d.assistant); })
	    .curve(d3.curveCardinal);
	var line_lecturer = d3.line()
	    .x(function(d){ return xScale(d.year); })
	    .y(function(d){ return yScale(d.lecturer); })
	    .curve(d3.curveCardinal); 

	var svg = d3.select('body').append('svg')
	    .attr('width', width)
	    .attr('height', height);

	var lineChart1 = svg.append("g").append("path")
	    .attr("class", "line")
	    .attr("stroke", colorset[0])
	    .attr("d", function(d){ return line_professor(data); });
	var lineChart2 = svg.append("g").append("path")
	    .attr("class", "line")
	    .attr("stroke", colorset[1])
	    .attr("d", function(d){ return line_associate(data); });
	var lineChart3 = svg.append("g").append("path")
	    .attr("class", "line")
	    .attr("stroke", colorset[2])
	    .attr("d", function(d){ return line_assistant(data); });
	var lineChart4 = svg.append("g").append("path")
	    .attr("class", "line")
	    .attr("stroke", colorset[3])
	    .attr("d", function(d){ return line_lecturer(data); });
	
	var linestyle = svg.selectAll("path")
	    .attr("transform", "translate(" + padding.left + "," + padding.top + ")");
	
	
	
	//Axis
	// Tick format: http://www.oxxostudio.tw/articles/201501/svg-d3-12-formatting.html
	
	var yAxis = d3.axisLeft(yScale);
	var xAxis = d3.axisBottom(xScale);
	var XaxisAppend = svg.append("g")
	    .attr("class", "axis")
	    //.attr("transform", "translate(0, "+(h-n)+")")
	    .attr("transform", "translate(" + padding.left + "," + (height - padding.bottom) + ")")
	    .call(xAxis.tickFormat(d3.format("d")));
	var YaxisAppend = svg.append("g")
	    .attr("class", "axis")
	    .attr("transform", "translate(" + padding.left + "," + padding.top + ")")
	    //.attr("transform", "translate("+n+", 0)")
	    .call(yAxis);
		

	//Focus and onMouse events

	var focusDot = svg.append("g")
	    .attr("class", "focusDot")
	    .style("display", "none");

	focusDot.append("circle")
	    .attr("fill", "white")
	    .attr("r", 4.5);

	focusDot.append("text")
	    .attr("dx", 10)
	    .attr("dy", "1em");



	var tracker = svg.append("rect")
	    .attr("class", "overlay")
	    .attr("x", padding.left)
	    .attr("y", padding.top)
	    .attr("width", width - padding.left - padding.right)
	    .attr("height", height - padding.top - padding.bottom)
	    .on("mouseover", function(){
		focusDot.style("display", null);
	    })
	    .on("mouseout", function(){
		focusDot.style("display", "none");
	    })
	    .on("mousemove", mousemove);

	function mousemove(){
	    var mouseX = d3.mouse(this)[0] - padding.left;
	    var mouseY = d3.mouse(this)[1] - padding.top;

	    var x0 = parseInt( xScale.invert( mouseX ) );
	    var y0 = yScale.invert( mouseY );
		
	    var bisect = d3.bisector( function(d){ return d.year; }).left;
	    var index = bisect(data, x0);
	    
	    var x1 = data[index].year;
	    var y1 = data[index].professor;
	    
	    var focusX = xScale(x1) + padding.left;
	    var focusY = yScale(y1) + padding.top;

	    focusDot.attr("transform", "translate(" + focusX + "," + focusY + ")");

	    focusDot.select("text")
		.text("Year:" + x1 + ", Num:" + y1)
		.attr("fill", "white");

	}
	
});


</script>

</body>
</html>
